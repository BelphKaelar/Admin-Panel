@{
    ViewData["Title"] = "Add Product";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Add Product</h2>

<form method="post" enctype="multipart/form-data" asp-controller="Products" asp-action="Add">
    <div class="form-group">
        <label for="p_name">Product Name</label>
        <input type="text" class="form-control" id="p_name" name="p_name" required/>
    </div>

    <div class="form-group">
        <label for="p_imgs">Product Images</label>
        <input type="file" class="form-control" id="p_imgs" name="p_imgs" accept="image/*" multiple />
        <div id="imagePreview"></div>
    </div>

    <div class="form-group">
        <label for="p_price">Price</label>
        <input type="text" class="form-control" id="p_price" name="p_price" step="0.01" required />
    </div>

    <div class="form-group">
        <label for="p_quantity">Quantity</label>
        <input type="number" class="form-control" id="p_quantity" name="p_quantity" required />
    </div>

    <div class="form-group">
        <label for="p_desc">Description</label>
        <textarea class="form-control" id="p_desc" name="p_desc" rows="4"></textarea>
    </div>

    <div class="form-group">
        <label for="p_seller">Seller</label>
        <input type="text" class="form-control" id="p_seller" name="p_seller" required />
    </div>

    <div class="form-group">
        <label for="p_colors">Colors (Optional, comma-separated RGB values)</label>
        <input type="text" class="form-control" id="p_colors" name="p_colors" />
    </div>

    <div class="form-group">
        <label for="p_category">Category</label>
        <select class="form-control" id="p_category" name="p_category" required>
            <option value="" disabled selected>Select Category</option>
            <option value="Laptop">Laptop</option>
            <option value="Gaming Laptop">Gaming Laptop</option>
            <option value="Headphones">Headphones</option>
            <option value="Monitor">Monitor</option>
            <option value="Speakers">Speakers</option>
            <option value="Mobile Phone">Mobile Phone</option>
            <option value="Console">Console</option>
            <option value="Mouse & Keyboard">Mouse & Keyboard</option>
            <option value="Accessories">Accessories</option>
        </select>
    </div>

    <div class="form-group">
        <label for="p_subcategory">Subcategory</label>
        <input type="text" class="form-control" id="p_subcategory" name="p_subcategory" required/>
    </div>

    <button type="submit" class="btn btn-primary mt-3">Add Product</button>
</form>

<script>
    const imageInput = document.getElementById("p_imgs");
    const imagePreview = document.getElementById("imagePreview");
    let selectedImages = []; // Array to hold the file names

    imageInput.addEventListener("change", function () {
        imagePreview.innerHTML = ""; // Reset preview
        Array.from(this.files).forEach(file => {
            const reader = new FileReader();
            reader.onload = function (e) {
                // Add image name to the selected images array
                selectedImages.push(file);

                // Display the file name and an option to remove
                const fileNameDiv = document.createElement("div");
                fileNameDiv.classList.add("img-thumbnail", "m-2");
                fileNameDiv.innerHTML = `${file.name}
                    <button class="btn btn-danger btn-sm" onclick="removeImage('${file.name}')">X</button>`;

                imagePreview.appendChild(fileNameDiv);
            };
            reader.readAsDataURL(file);
        });
    });

    function removeImage(fileName) {
        // Remove image from the array
        const index = selectedImages.findIndex(img => img.name === fileName);
        if (index > -1) {
            selectedImages.splice(index, 1); // Remove the image from the array
        }

        // Remove file name element from the preview
        const previewDiv = document.querySelector(`div:contains('${fileName}')`);
        if (previewDiv) {
            previewDiv.remove();
        }
    }
</script>